<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Rentals - Backyard Adventures</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/rentals.css">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav class="main-nav">
            <div class="logo">Backyard Adventures</div>
            <button class="mobile-menu-toggle" aria-label="Toggle Menu">
                <span></span><span></span><span></span>
            </button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="tours.html">Guided Tours</a></li>
                <li><a href="rentals.html" class="active">Equipment Rentals</a></li>
                <li><a href="instruction.html">Instructions</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="portal/login.html" class="cta-button">Customer Portal</a></li>
            </ul>
        </nav>
    </header>

  <main>
        <!-- Hero Section -->
        <section class="page-header">
            <div class="header-overlay"></div>
            <div class="header-content">
                <div class="header-icon">
                    <i class="fas fa-water"></i>
                </div>
                <h1>Equipment Rentals</h1>
                <p>Premium water sports equipment for your adventure</p>
                <div class="header-stats">
                    <div class="stat-item">
                        <i class="fas fa-tools"></i>
                        <span>Latest Gear</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Safety First</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-tags"></i>
                        <span>Best Rates</span>
                    </div>
                </div>
            </div>
        </section>

  <!-- Filters Section -->
  <section class="rental-filters">
    <div class="section-header">
      <h2>Find Your Equipment</h2>
      <p class="section-subtitle">Filter by type, duration, and price</p>
    </div>
    <div class="filter-container">
      <div class="filter-item">
        <i class="fas fa-layer-group"></i>
        <select id="equipment-type-filter">
          <option value="">Equipment Type</option>
          <option value="kayak">Kayaks</option>
          <option value="paddleboard">Paddleboards</option>
          <option value="canoe">Canoes</option>
        </select>
      </div>
      <div class="filter-item">
        <i class="far fa-clock"></i>
        <select id="duration-filter">
          <option value="">Rental Duration</option>
          <option value="hourly">Hourly</option>
          <option value="daily">Full Day</option>
        </select>
      </div>
      <div class="filter-item">
        <i class="fas fa-dollar-sign"></i>
        <select id="price-filter">
          <option value="">Price Range</option>
          <option value="0-25">Under KSh 25/hour</option>
          <option value="25-50">KSh 25 - KSh 50/hour</option>
          <option value="50+">KSh 50+/hour</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Equipment Cards -->
  <section class="equipment-section">
    <div class="equipment-grid">
      <div class="equipment-card">
        <div class="equipment-image">
          <img src="assets/kayak.jpg" alt="Kayak">
          <div class="equipment-badge">Popular</div>
        </div>
        <div class="equipment-info">
          <div class="icon-wrapper">
            <i class="fas fa-ship"></i>
          </div>
          <h3>Single Kayak</h3>
          <p>Explore the calm marina waters with our premium kayaks. Perfect for solo adventures.</p>
          <div class="price-info">
            <span class="price">KSh 25/hr</span>
            <span class="duration">• Full Day: KSh 80</span>
          </div>
          <button class="cta-button primary">
            <i class="fas fa-calendar-check"></i>
            Rent Now
          </button>
        </div>
      </div>

      <div class="equipment-card">
        <div class="equipment-image">
          <img src="assets/paddle.jpg" alt="Paddleboard">
          <div class="equipment-badge featured">Featured</div>
        </div>
        <div class="equipment-info">
          <div class="icon-wrapper">
            <i class="fas fa-water"></i>
          </div>
          <h3>Stand-Up Paddleboard</h3>
          <p>Enjoy a smooth paddle session under the Florida sun. Great for fitness and fun.</p>
          <div class="price-info">
            <span class="price">KSh 20/hr</span>
            <span class="duration">• Full Day: KSh 65</span>
          </div>
          <button class="cta-button primary">
            <i class="fas fa-calendar-check"></i>
            Rent Now
          </button>
        </div>
      </div>

      <div class="equipment-card">
        <div class="equipment-image">
          <img src="assets/jetski.jpg" alt="Jet Ski">
          <div class="equipment-badge premium">Premium</div>
        </div>
        <div class="equipment-info">
          <div class="icon-wrapper">
            <i class="fas fa-bolt"></i>
          </div>
          <h3>Jet Ski</h3>
          <p>Feel the adrenaline rush across the waves with our high-performance jet skis.</p>
          <div class="price-info">
            <span class="price">KSh 80/hr</span>
            <span class="duration">• Full Day: KSh 250</span>
          </div>
          <button class="cta-button primary">
            <i class="fas fa-calendar-check"></i>
            Rent Now
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Rental Info Section -->
  <section class="rental-info">
    <div class="section-header">
      <h2>Rental Information</h2>
      <p class="section-subtitle">Everything you need to know</p>
    </div>
    <div class="info-grid">
      <div class="info-card">
        <div class="icon-wrapper">
          <i class="fas fa-file-contract"></i>
        </div>
        <h3>Rental Policies</h3>
        <ul>
          <li><i class="fas fa-check-circle"></i> Valid ID and credit card required</li>
          <li><i class="fas fa-check-circle"></i> Age requirements vary by equipment</li>
          <li><i class="fas fa-check-circle"></i> 24-hour cancellation policy</li>
          <li><i class="fas fa-check-circle"></i> Weather-related rescheduling available</li>
        </ul>
      </div>
      <div class="info-card">
        <div class="icon-wrapper">
          <i class="fas fa-box-open"></i>
        </div>
        <h3>What's Included</h3>
        <ul>
          <li><i class="fas fa-check-circle"></i> Safety gear (life jackets, etc.)</li>
          <li><i class="fas fa-check-circle"></i> Basic instruction if needed</li>
          <li><i class="fas fa-check-circle"></i> Equipment insurance</li>
          <li><i class="fas fa-check-circle"></i> Storage lockers</li>
        </ul>
      </div>
      <div class="info-card">
        <div class="icon-wrapper">
          <i class="fas fa-clipboard-check"></i>
        </div>
        <h3>Requirements</h3>
        <ul>
          <li><i class="fas fa-check-circle"></i> Signed waiver form</li>
          <li><i class="fas fa-check-circle"></i> Basic swimming ability</li>
          <li><i class="fas fa-check-circle"></i> Appropriate attire</li>
          <li><i class="fas fa-check-circle"></i> Understanding of safety rules</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Weather Advisory -->
  <section class="weather-advisory">
    <div class="icon-wrapper">
      <i class="fas fa-cloud-sun"></i>
    </div>
    <h2>Weather Advisory</h2>
    <div class="weather-content">
      <p>
        Our rental operations are weather-dependent. In case of severe
        conditions, we may reschedule your rental. Always check the latest
        weather forecast before booking.
      </p>
      <div class="weather-features">
        <div class="feature-item">
          <i class="fas fa-check-circle"></i>
          <span>Real-time weather monitoring</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-check-circle"></i>
          <span>Free rescheduling for bad weather</span>
        </div>
        <div class="feature-item">
          <i class="fas fa-check-circle"></i>
          <span>Safety-first approach</span>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Phone: (555) 123-4567</p>
                <p>Email: info@backyardadventures.com</p>
            </div>
            <div class="footer-section">
                <h3>Business Hours</h3>
                <p>Mon-Fri: 8:00 AM - 6:00 PM</p>
                <p>Sat-Sun: 7:00 AM - 7:00 PM</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="tours.html">Tours</a></li>
                    <li><a href="rentals.html">Rentals</a></li>
                    <li><a href="instruction.html">Instructions</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Backyard Adventures. All rights reserved.</p>
        </div>
    </footer>

    <!-- Supabase Integration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-auth.js"></script>
    <script src="js/supabase-queries.js"></script>
    
    <script src="js/data.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/rentals.js"></script>
    
    <script>
    // ===================================
    // RENTALS PAGE - SUPABASE INTEGRATION
    // ===================================
    
    let equipmentData = [];
    let currentFilters = {
        type: '',
        duration: '',
        price: ''
    };

    // Load equipment from Supabase
    async function loadEquipmentFromDatabase() {
        const result = await supabaseQueries.getAvailableEquipment();
        
        if (result.success && result.data.length > 0) {
            equipmentData = result.data;
            displayEquipment(equipmentData);
        } else {
            console.log('No equipment in database');
        }
    }

    // Display equipment in grid
    function displayEquipment(equipment) {
        const equipmentGrid = document.querySelector('.equipment-grid');
        if (!equipmentGrid) return;

        if (equipment.length === 0) {
            equipmentGrid.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <p>No equipment found matching your criteria</p>
                    <button onclick="clearEquipmentFilters()" class="btn-primary">Clear Filters</button>
                </div>
            `;
            return;
        }

        equipmentGrid.innerHTML = equipment.map(item => `
            <div class="equipment-card" data-equipment-id="${item.id}">
                <div class="equipment-image">
                    <img src="${item.image_url || 'assets/equipment-default.jpg'}" alt="${item.name}">
                    ${item.badge ? `<span class="equipment-badge ${item.badge}">${item.badge}</span>` : ''}
                </div>
                <div class="equipment-info">
                    <div class="icon-wrapper">
                        <i class="fas fa-${getEquipmentIcon(item.type)}"></i>
                    </div>
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <div class="price-info">
                        <div class="price">KSh ${item.hourly_rate}/hour</div>
                        <div class="duration">KSh ${item.daily_rate}/day</div>
                    </div>
                    <button class="cta-button" onclick="rentEquipment('${item.id}', '${item.name}', ${item.hourly_rate}, ${item.daily_rate})">
                        <i class="fas fa-shopping-cart"></i> Rent Now
                    </button>
                </div>
            </div>
        `).join('');
    }

    // Get icon for equipment type
    function getEquipmentIcon(type) {
        const icons = {
            'kayak': 'ship',
            'jet-ski': 'water',
            'snorkel-gear': 'swimmer',
            'paddleboard': 'water',
            'canoe': 'ship'
        };
        return icons[type] || 'water';
    }

    // Filter equipment
    function filterEquipment() {
        let filtered = [...equipmentData];

        if (currentFilters.type) {
            filtered = filtered.filter(item => 
                item.type.toLowerCase() === currentFilters.type.toLowerCase()
            );
        }

        if (currentFilters.price) {
            filtered = filtered.filter(item => {
                const rate = parseFloat(item.hourly_rate);
                if (currentFilters.price === '0-25') return rate < 25;
                if (currentFilters.price === '25-50') return rate >= 25 && rate <= 50;
                if (currentFilters.price === '50+') return rate > 50;
                return true;
            });
        }

        displayEquipment(filtered);
    }

    // Clear filters
    function clearEquipmentFilters() {
        currentFilters = { type: '', duration: '', price: '' };
        document.getElementById('equipment-type-filter').value = '';
        document.getElementById('duration-filter').value = '';
        document.getElementById('price-filter').value = '';
        displayEquipment(equipmentData);
    }

    // Rent equipment function
    async function rentEquipment(equipmentId, equipmentName, hourlyRate, dailyRate) {
        const user = await supabaseHelpers.getCurrentUser();
        
        if (!user) {
            supabaseHelpers.showNotification('Please login to rent equipment', 'info');
            setTimeout(() => {
                window.location.href = 'portal/login.html?redirect=' + encodeURIComponent(window.location.href);
            }, 1500);
            return;
        }

        showRentalModal(equipmentId, equipmentName, hourlyRate, dailyRate);
    }

    // Show rental modal
    function showRentalModal(equipmentId, equipmentName, hourlyRate, dailyRate) {
        const modal = document.createElement('div');
        modal.className = 'booking-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <button class="close-modal" onclick="closeRentalModal()">
                    <i class="fas fa-times"></i>
                </button>
                <h2>Rent: ${equipmentName}</h2>
                <form id="rentalForm" class="booking-form">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Start Date & Time</label>
                        <input type="datetime-local" name="start_date" 
                               min="${new Date().toISOString().slice(0, 16)}" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> End Date & Time</label>
                        <input type="datetime-local" name="end_date" 
                               min="${new Date().toISOString().slice(0, 16)}" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Rental Duration</label>
                        <select name="duration_type" id="durationType" required>
                            <option value="">Select duration type...</option>
                            <option value="hourly">Hourly - KSh ${hourlyRate}/hour</option>
                            <option value="daily">Daily - KSh ${dailyRate}/day</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-hashtag"></i> Number of Units</label>
                        <input type="number" name="units" min="1" max="1" value="1" id="unitsInput" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-comment"></i> Special Requests (Optional)</label>
                        <textarea name="requests" rows="3" placeholder="Any special requirements?"></textarea>
                    </div>
                    <div class="price-summary">
                        <span>Rate:</span>
                        <span class="price-value" id="rateDisplay">Select duration type</span>
                    </div>
                    <div class="total-summary">
                        <span>Estimated Total:</span>
                        <span id="modalRentalTotal" class="total-value">KSh 0</span>
                    </div>
                    <button type="submit" class="submit-booking">
                        <i class="fas fa-check"></i> Confirm Rental
                    </button>
                </form>
            </div>
        `;

        document.body.appendChild(modal);

        // Calculate rental duration and cost
        const startInput = modal.querySelector('input[name="start_date"]');
        const endInput = modal.querySelector('input[name="end_date"]');
        const durationTypeSelect = modal.querySelector('#durationType');
        const unitsInput = modal.querySelector('#unitsInput');

        function calculateTotal() {
            const start = new Date(startInput.value);
            const end = new Date(endInput.value);
            const durationType = durationTypeSelect.value;
            const units = parseInt(unitsInput.value) || 1;

            if (!start || !end || !durationType) return;

            const diffMs = end - start;
            const diffHours = diffMs / (1000 * 60 * 60);
            
            let cost = 0;
            let rateText = '';

            if (durationType === 'hourly') {
                cost = Math.ceil(diffHours) * hourlyRate * units;
                rateText = `KSh ${hourlyRate}/hour × ${Math.ceil(diffHours)} hours`;
            } else if (durationType === 'daily') {
                const days = Math.ceil(diffHours / 24);
                cost = days * dailyRate * units;
                rateText = `KSh ${dailyRate}/day × ${days} days`;
            }

            document.getElementById('rateDisplay').textContent = rateText;
            document.getElementById('modalRentalTotal').textContent = `KSh ${cost}`;
        }

        startInput.addEventListener('change', calculateTotal);
        endInput.addEventListener('change', calculateTotal);
        durationTypeSelect.addEventListener('change', calculateTotal);
        unitsInput.addEventListener('input', calculateTotal);

        // Handle form submission
        const form = modal.querySelector('#rentalForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            await submitRental(e.target, equipmentId, hourlyRate, dailyRate);
        });

        // Close on outside click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeRentalModal();
        });
    }

    // Submit rental to database
    async function submitRental(form, equipmentId, hourlyRate, dailyRate) {
        const formData = new FormData(form);
        const startDate = new Date(formData.get('start_date'));
        const endDate = new Date(formData.get('end_date'));
        const durationType = formData.get('duration_type');
        
        const diffMs = endDate - startDate;
        const diffHours = Math.ceil(diffMs / (1000 * 60 * 60));
        
        let totalPrice = 0;
        if (durationType === 'hourly') {
            totalPrice = diffHours * hourlyRate;
        } else {
            const days = Math.ceil(diffHours / 24);
            totalPrice = days * dailyRate;
        }

        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

        const result = await supabaseQueries.createEquipmentRental({
            equipmentId: equipmentId,
            startDate: startDate.toISOString(),
            endDate: endDate.toISOString(),
            durationHours: diffHours,
            totalPrice: totalPrice
        });

        if (result.success) {
            supabaseHelpers.showNotification('Rental confirmed! Check your dashboard.', 'success');
            closeRentalModal();
            setTimeout(() => {
                window.location.href = 'portal/dashboard.html';
            }, 2000);
        } else {
            supabaseHelpers.showNotification('Rental failed: ' + result.error, 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-check"></i> Confirm Rental';
        }
    }

    // Close rental modal
    function closeRentalModal() {
        const modal = document.querySelector('.booking-modal');
        if (modal) modal.remove();
    }

    // Setup filter listeners
    function setupEquipmentFilters() {
        const typeFilter = document.getElementById('equipment-type-filter');
        const priceFilter = document.getElementById('price-filter');

        if (typeFilter) {
            typeFilter.addEventListener('change', (e) => {
                currentFilters.type = e.target.value;
                filterEquipment();
            });
        }

        if (priceFilter) {
            priceFilter.addEventListener('change', (e) => {
                currentFilters.price = e.target.value;
                filterEquipment();
            });
        }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
        loadEquipmentFromDatabase();
        setupEquipmentFilters();
    });

    // Make functions globally available
    window.rentEquipment = rentEquipment;
    window.closeRentalModal = closeRentalModal;
    window.clearEquipmentFilters = clearEquipmentFilters;
    </script>
</body>
</html>